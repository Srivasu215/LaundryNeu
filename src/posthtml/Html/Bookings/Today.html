<!doctype html>
<html lang="en">

<head>
	<title>Booking Customers Barcode</title>
	<!-- Required meta tags -->
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	<!-- Bootstrap CSS v5.2.0-beta1 -->
	<!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css"
		integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous"> -->
	<link rel="stylesheet" href="/css/bootstrap.min.css">

	<script type="text/javascript" src="/js/bwip-js-min.js"></script>

	<!-- <link rel="stylesheet" href="https://printjs-4de6.kxcdn.com/print.min.css"> -->
	<link rel="stylesheet" href="/css/print.min.css">
	<link rel="stylesheet" href="/css/header.css">
</head>

<body>
	<header>
		<nav class="navbar navbar-expand-xl navbar-dark bg-dark" aria-label="Sixth navbar example">
			<div class="container-fluid">
				<a class="navbar-brand" href="#">Bookings</a>
				<button class="navbar-toggler" type="button" data-bs-toggle="collapse"
					data-bs-target="#navbarsExample06" aria-controls="navbarsExample06" aria-expanded="false"
					aria-label="Toggle navigation">
					<span class="navbar-toggler-icon"></span>
				</button>

				<div class="collapse navbar-collapse" id="navbarsExample06">
					<ul class="navbar-nav me-auto mb-2 mb-xl-0">
						<li class="nav-item">
							<a class="nav-link active" aria-current="page" href="../Start.html">
								<svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor"
									class="bi d-block mx-auto mb-1" viewBox="0 0 16 16">
									<path fill-rule="evenodd"
										d="M2 13.5V7h1v6.5a.5.5 0 0 0 .5.5h9a.5.5 0 0 0 .5-.5V7h1v6.5a1.5 1.5 0 0 1-1.5 1.5h-9A1.5 1.5 0 0 1 2 13.5zm11-11V6l-2-2V2.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5z">
									</path>
									<path fill-rule="evenodd"
										d="M7.293 1.5a1 1 0 0 1 1.414 0l6.647 6.646a.5.5 0 0 1-.708.708L8 2.207 1.354 8.854a.5.5 0 1 1-.708-.708L7.293 1.5z">
									</path>
								</svg>
								Home
							</a>
						</li>
						<li class="nav-item">
							<a class="nav-link active text-white" href="./Bookings.html">
								<svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi d-block mx-auto mb-1" viewBox="0 0 16 16">
									<path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/>
									<path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z"/>
								  </svg>
								Bookings
							</a>
						</li>
						<li class="nav-item">
							<a class="nav-link active text-info" href="./Today.html">
								<svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi d-block mx-auto mb-1" viewBox="0 0 16 16">
									<path d="M2 10h3a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1zm9-9h3a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-3a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zm0 9a1 1 0 0 0-1 1v3a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1h-3zm0-10a2 2 0 0 0-2 2v3a2 2 0 0 0 2 2h3a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2h-3zM2 9a2 2 0 0 0-2 2v3a2 2 0 0 0 2 2h3a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2H2zm7 2a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2h-3a2 2 0 0 1-2-2v-3zM0 2a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2zm5.354.854a.5.5 0 1 0-.708-.708L3 3.793l-.646-.647a.5.5 0 1 0-.708.708l1 1a.5.5 0 0 0 .708 0l2-2z"/>
								  </svg>
								Today
							</a>
						</li>
						<li class="nav-item">
							<a class="nav-link text-white" href="./All.html">
								<svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi d-block mx-auto mb-1" viewBox="0 0 16 16">
									<path d="M13.81 3H9.828a2 2 0 0 1-1.414-.586l-.828-.828A2 2 0 0 0 6.172 1H2.5a2 2 0 0 0-2 2l.04.87a1.99 1.99 0 0 0-.342 1.311l.637 7A2 2 0 0 0 2.826 14h10.348a2 2 0 0 0 1.991-1.819l.637-7A2 2 0 0 0 13.81 3zM2.19 3c-.24 0-.47.042-.683.12L1.5 2.98a1 1 0 0 1 1-.98h3.672a1 1 0 0 1 .707.293L7.586 3H2.19zm9.608 5.271-3.182 1.97c-.27.166-.616-.036-.616-.372V9.1s-2.571-.3-4 2.4c.571-4.8 3.143-4.8 4-4.8v-.769c0-.336.346-.538.616-.371l3.182 1.969c.27.166.27.576 0 .742z"/>
								  </svg>
								All
							</a>
						</li>
						<li class="nav-item">
							<a class="nav-link text-white" href="./TodayBarcode.html">
								<svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi d-block mx-auto mb-1" viewBox="0 0 16 16">
									<path d="M2 2h2v2H2V2Z"/>
									<path d="M6 0v6H0V0h6ZM5 1H1v4h4V1ZM4 12H2v2h2v-2Z"/>
									<path d="M6 10v6H0v-6h6Zm-5 1v4h4v-4H1Zm11-9h2v2h-2V2Z"/>
									<path d="M10 0v6h6V0h-6Zm5 1v4h-4V1h4ZM8 1V0h1v2H8v2H7V1h1Zm0 5V4h1v2H8ZM6 8V7h1V6h1v2h1V7h5v1h-4v1H7V8H6Zm0 0v1H2V8H1v1H0V7h3v1h3Zm10 1h-1V7h1v2Zm-1 0h-1v2h2v-1h-1V9Zm-4 0h2v1h-1v1h-1V9Zm2 3v-1h-1v1h-1v1H9v1h3v-2h1Zm0 0h3v1h-2v1h-1v-2Zm-4-1v1h1v-2H7v1h2Z"/>
									<path d="M7 12h1v3h4v1H7v-4Zm9 2v2h-3v-1h2v-1h1Z"/>
								  </svg>
								QrCode
							</a>
						</li>
						<li class="nav-item">
							<a class="nav-link text-white" href="./ToStart.html">
								<svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi d-block mx-auto mb-1" viewBox="0 0 16 16">
									<path d="M11.534 7h3.932a.25.25 0 0 1 .192.41l-1.966 2.36a.25.25 0 0 1-.384 0l-1.966-2.36a.25.25 0 0 1 .192-.41zm-11 2h3.932a.25.25 0 0 0 .192-.41L2.692 6.23a.25.25 0 0 0-.384 0L.342 8.59A.25.25 0 0 0 .534 9z"/>
									<path fill-rule="evenodd" d="M8 3c-1.552 0-2.94.707-3.857 1.818a.5.5 0 1 1-.771-.636A6.002 6.002 0 0 1 13.917 7H12.9A5.002 5.002 0 0 0 8 3zM3.1 9a5.002 5.002 0 0 0 8.757 2.182.5.5 0 1 1 .771.636A6.002 6.002 0 0 1 2.083 9H3.1z"/>
								  </svg>
								ToStart
							</a>
						</li>
					</ul>
					<form role="search" onsubmit="return false;">
						<input id="SearchQrCodeId" class="form-control" type="search" placeholder="Search"
							aria-label="Search" onkeypress="jFSearchKeyPress(event)">
					</form>
				</div>
			</div>
		</nav>

	</header>
	<main>
	

		<div class="container">
			<div class="row">
				<div class="col-7">
					<button type="button" class="btn btn-primary" onclick="jFShowData()">Show Data</button>

					<div id="AlertDangerId" class="alert alert-danger alert-dismissible fade show" role="alert"
						style="display:none;">
						<div id="AlertDangerMessageId"><strong>Sorry!</strong> Data not saved</div>
						<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
					</div>

					<div class="table-responsive">
						<table class="table">
							<thead>
								<tr>
									<th scope="col">#</th>
									<th scope="col">Customer Name</th>
									<th scope="col">Mobile</th>
									<th scope="col">Garments</th>
									<th scope="col">Weight</th>
									<th scope="col">Amount</th>
								

								</tr>
							</thead>
							<tbody id="KTableBody">

							</tbody>
						</table>
					</div>

				</div>
				<div class="col-5">
					<form id="FormVertical" onsubmit="return false;">
						<div class="mb-3">
							<label for="CustomerName" class="form-label">Customer Name</label>
							<input type="text" class="form-control" name="CustomerName" id="CustomerName"
								aria-describedby="emailHelp" required="">
							<div class="invalid-feedback">
								Should not be empty!
							</div>
						</div>
						<div class="mb-3">
							<label for="Mobile" class="form-label">Mobile</label>
							<input type="tel" class="form-control" name="Mobile" id="Mobile" pattern="[6789][0-9]{9}">
						</div>

						<div class="mb-3">
							<label for="Garments" class="form-label">Garments</label>
							<input type="text" class="form-control" name="Garments" id="Garments"
								aria-describedby="emailHelp" required="">
							<div class="invalid-feedback">
								Should not be empty!
							</div>
						</div>

						<div class="mb-3">
							<label for="Weight" class="form-label">Weight</label>
							<input type="number" class="form-control" name="Weight" id="Weight"
								aria-describedby="emailHelp" required="">
							<div class="invalid-feedback">
								Should not be empty!
							</div>
						</div>

						<div class="mb-3">
							<label for="Amount" class="form-label">Amount</label>
							<input type="number" class="form-control" name="Amount" id="Amount"
								aria-describedby="emailHelp" required="">
							<div class="invalid-feedback">
								Should not be empty!
							</div>
						</div>



						<div class="mb-3 form-check">
							<input type="checkbox" class="form-check-input" id="exampleCheck1">
							<label class="form-check-label" for="exampleCheck1">Check me out</label>
						</div>
						<button class="btn btn-success" onclick="jFSave()">Save</button>
					</form>

					<div id="AlertWarningId" class="alert alert-warning alert-dismissible fade show" role="alert"
						style="display:none;">
						<div id="AlertWarningMessageId"><strong>Sorry!</strong> Data not saved</div>
						<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
					</div>

					<div id="AlertSuccessId" class="alert alert-success alert-dismissible fade show" role="alert"
						style="display:none;">
						<div id="AlertSuccessMessageId"><strong>Hurray!</strong> Data saved</div>
						<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
					</div>

				</div>
			</div>
		</div>

		<!-- Modal -->
		<div class="modal fade" id="ModalForQrCode" tabindex="-1" aria-labelledby="exampleModalLabel"
			aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
					</div>
					<div class="modal-body" id="ModalBody">
						<div class="row">
							<div class="col" id="ModalCustomerName"></div>
						</div>
						<div class="row">
							<div class="col">
								<canvas id="canvas" width=1 height=1
									style="border:1px solid #fff;visibility:hidden"></canvas>
							</div>

						</div>
						<div class="row">
							<div class="col" id="ModalPK">

							</div>

						</div>
						<div class="row">
							<div class="col" id="ModalGarments">

							</div>

						</div>
						<div class="row">
							<div class="col" id="ModalWeight">

							</div>

						</div>
						<div class="row">
							<div class="col fw-bold" id="ModalMobile">

							</div>

						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-primary"
							onclick="printJS('ModalBody', 'html')">Print</button>
					</div>
				</div>
			</div>
		</div>

	</main>


	<div class="modal fade" id="ShowModalId" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">Modal title</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
				</div>
				<div class="modal-footer">
				</div>
			</div>
		</div>
	</div>


	<footer class="footer mt-auto py-2 bg-light fixed-bottom">
		<div class="container">
			<div class="bg-light d-flex justify-content-between">
				<div>KeshavSoft v9.26</div>
				<div data-BaseString="Last refresh : " id="KLastRefreshDT">Last refresh : </div>
			</div>
		</div>
	</footer>
	<!-- Bootstrap JavaScript Libraries -->
	<!-- <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.5/dist/umd/popper.min.js"
		integrity="sha384-Xe+8cL9oJa6tN/veChSP7q+mnSPaj5Bcu9mPX5F5xIGE0DVittaqT5lorf0EI7Vk" crossorigin="anonymous">
		</script>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.min.js"
		integrity="sha384-ODmDIVzN+pFdexxHEHFBQH3/9/vQ9uori45z4JjnFsRydbmQbmL5t1tQ0culUzyK" crossorigin="anonymous">
		</script> -->

	<script src="/js/bootstrap.min.js"></script>

	<script src="/js/neutralino.js"></script>
	<script src="/js/handlebars.min-v4.7.7.js"></script>
	<script src="/js/lodash.js"></script>
	<script src="/js/print.min.js"></script>
	<script src="/js/KeshavSoft/HandleBars/HelperFuns.js"></script>
	
	<script src="/Dal/Bookings/Insert.js"></script>
	<script src="/Dal/Bookings/Show.js"></script>
     <script src="/Dal/Bookings/Delete.js"></script>
	<script src="/Dal/Bookings/Pick.js"></script>

	<script>
		let jFGenerateQrCodeOnCanvas = ({ inQrData = "" }) => {
			var canvas = document.getElementById('canvas');
			canvas.height = 1;
			canvas.width = 1;
			canvas.style.visibility = 'hidden';

			// Convert the options to an object.
			let opts = {};

			// Finish up the options
			opts.text = inQrData;
			opts.bcid = "qrcode";
			opts.scaleX = 1;
			opts.scaleY = 1;
			opts.rotate = "N";

			// Draw the bar code to the canvas
			try {
				let ts0 = new Date;
				bwipjs.toCanvas(canvas, opts);
				show(ts0, new Date);
			} catch (e) {
				console.log("error : ", e);
				// Watch for BWIPP generated raiseerror's.

				return;
			}

			function show(ts0, ts1) {
				canvas.style.visibility = 'visible';
				//setURL();
				// document.getElementById('stats').textContent = 'Rendered in ' + (ts1 - ts0) + ' msecs.';
				// document.getElementById('saveas').style.visibility = 'visible';
				// saveCanvas.basename = elt.sym + '-' + text.replace(/[^a-zA-Z0-9._]+/g, '-');

			}
		};

		let serializeObject = (form) => {
			// Create a new FormData object
			const formData = new FormData(form);

			// Create an object to hold the name/value pairs
			const pairs = {};

			// Add each name/value pair to the object
			for (const [name, value] of formData) {
				pairs[name] = value;
			}

			// Return the object
			return pairs;
		};

		let jFShowData = async () => {
			let LocalDataFromJson = await ShowTodayFunc();
			let LocalDataToHbs = {};
			let LocalSNo = 1;

			let LocalDataWithSno = Object.keys(LocalDataFromJson.JsonData).map((element, LoopIndex) => {
				element.SNo = LoopIndex + 1;
				return element;
			});

			Object.entries(LocalDataFromJson.JsonData).forEach(
				([key, value]) => {
					LocalDataToHbs[key] = value;
					LocalDataToHbs[key].SNo = LocalSNo;
					LocalSNo += 1;
				}
			);

			let response = await fetch("Hbs/Row.html");
			let data = await response.text();

			var template = Handlebars.compile(data);
			let jVarLocalHtml = template(LocalDataToHbs);

			document.getElementById("KTableBody").innerHTML = jVarLocalHtml;
		};

		let jFSave = async () => {
			let jVarLocalFormVertical = document.getElementById("FormVertical");

			jVarLocalFormVertical.classList.remove('was-validated');
			jVarLocalFormVertical.classList.add('novalidate');

			if (jVarLocalFormVertical.checkValidity()) {
				let PromiseDataFromSave = await InsertFunc({ inObjectToInsert: serializeObject(jVarLocalFormVertical) });

				if (PromiseDataFromSave.KTF) {
					await jFShowData();

					let jVarLocalAlertSuccessId = document.getElementById("AlertSuccessId");
					let jVarLocalAlertSuccessMessageId = document.getElementById("AlertSuccessMessageId");
					jVarLocalAlertSuccessId.style.display = "";
					jVarLocalAlertSuccessMessageId.innerHTML = `<strong>Hurray!</strong> ${PromiseDataFromSave.KResult}`

					setTimeout(function () {
						jVarLocalAlertSuccessId.style.display = "none"

					}, 7000);
				} else {
					let jVarLocalAlertDangerId = document.getElementById("AlertWarningId");
					let jVarLocalAlertDangerMessageId = document.getElementById("AlertWarningMessageId");
					jVarLocalAlertDangerId.style.display = "";
					jVarLocalAlertDangerMessageId.innerHTML = `<strong>Sorry!</strong> ${PromiseDataFromSave.KReason}`

					setTimeout(function () {
						jVarLocalAlertDangerId.style.display = "none"

					}, 7000);
				};
			} else {
				document.forms[1].classList.add('was-validated');
			};
		};

		let jFDelete = async ({ inRowPK }) => {
			let LocalFromDelete = await DeleteFunc({ inRowPK });

			if (LocalFromDelete.KTF) {
				await jFShowData();

				let jVarLocalAlertDangerId = document.getElementById("AlertDangerId");
				let jVarLocalAlertDangerMessageId = document.getElementById("AlertDangerMessageId");
				jVarLocalAlertDangerId.style.display = "";
				jVarLocalAlertDangerMessageId.innerHTML = `<strong>Ok!</strong> ${LocalFromDelete.KResult}`

				setTimeout(function () {
					jVarLocalAlertDangerId.style.display = "none"

				}, 7000);
			};
		};

		let jFPickFunc = async ({ inRowPK }) => {
			let jVarLocalDataNeeded = await PickFunc({ inRowPK });

			if (jVarLocalDataNeeded.KTF) {
				let jVarLocalModalCustomerName = document.getElementById("ModalCustomerName");
				let jVarLocalModalPK = document.getElementById("ModalPK");
				let jVarLocalModalGarments = document.getElementById("ModalGarments");
				let jVarLocalModalWeight = document.getElementById("ModalWeight");
				let jVarLocalModalMobile = document.getElementById("ModalMobile");

				jVarLocalModalCustomerName.innerHTML = jVarLocalDataNeeded.KResult.CustomerName;
				jVarLocalModalPK.innerHTML = inRowPK;
				jVarLocalModalGarments.innerHTML = jVarLocalDataNeeded.KResult.Garments;
				jVarLocalModalWeight.innerHTML = `${jVarLocalDataNeeded.KResult.Weight} Kg.`;
				jVarLocalModalMobile.innerHTML = jVarLocalDataNeeded.KResult.Mobile;

				let jVarLocalQrData = `${inRowPK}/${jVarLocalDataNeeded.KResult.CustomerName}/${jVarLocalDataNeeded.KResult.Mobile}/${jVarLocalDataNeeded.KResult.Garments}/${jVarLocalDataNeeded.KResult.Weight}`;
				jFGenerateQrCodeOnCanvas({ inQrData: jVarLocalQrData });

				let jVarLocalId = "ModalForQrCode";

				var myModal = new bootstrap.Modal(document.getElementById(jVarLocalId), { keyboard: true, focus: true });

				myModal.show();
			};
		};

		import("/js/khand.js").then(p => {
			p.HelperFuns.ForSno();
		});

		let jFSearchKeyPress = async (inEvent) => {
			if (inEvent.keyCode === 13) {
				let jVarLocalCurrentTarget = inEvent.currentTarget;
				let jVarLocalSearchValue = jVarLocalCurrentTarget.value;
				let jVarLocalSearchValueArray = jVarLocalSearchValue.split("/");

				let jVarLocalDataNeeded = await PickFunc({ inRowPK: jVarLocalSearchValueArray[0] });

				if (jVarLocalDataNeeded.KTF) {

					console.log("jVarLocalDataNeeded : ", jVarLocalDataNeeded);

					let response = await fetch("Hbs/PopUp/Vertical.html");
					let data = await response.text();

					var template = Handlebars.compile(data);
					let jVarLocalHtml = template(jVarLocalDataNeeded.KResult);
					let jVarLocalShowModalId = document.getElementById("ShowModalId");
					jVarLocalShowModalId.querySelector(".modal-body").innerHTML = jVarLocalHtml;

					var myModal = new bootstrap.Modal(jVarLocalShowModalId, { keyboard: false, focus: true });
					myModal.show();

				};
			};
		};

		Neutralino.init();
		jFShowData();
	</script>
</body>

</html>